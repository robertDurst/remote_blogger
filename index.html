<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5 Herald</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <link rel="stylesheet" href="style.css?v=1.0">

  <!-- Bootstrap -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>

<body>
  <nav class="navbar navbar-dark bg-dark"> 
    <h1 class="navbar-brand">Rob's India Picture Blog (click images to expand)</h1>
  </nav>

  <div id="posts">
  </div>

  <!-- The Modal -->
  <div id="myModal" class="modal">

    <!-- The Close Button -->
    <span class="close" style="color: white;">&times;</span>

    <!-- Modal Content (The Image) -->
    <img class="modal-content" id="img01">

    <!-- Modal Caption (Image Text) -->
    <div id="caption"></div>
  </div>

  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

</body>
  <script>
    function update() {
      $.get( "http://127.0.0.1:3000/posts", function( data ) {
        // remove all old posts
        $('#posts .inside').remove();
        $('#posts').append(`<div class="inside"></div>`);
        let column_index = 0;
        data.forEach((x,i) => {
          if (i % 4 == 0) {
            column_index += 1;
            $('#posts .inside').append(`<div class="column" id="column${column_index}">`);
          }
          $(`#posts .inside #column${column_index}`).append(`
            <div class="card">
            <div class="card-top">
              <img class="card-img" id=${i} src="${x.image_url}" alt="Card image cap">
              <p class="card-date">${x.date}</p>
            </div>
          </div>
            `);
       
          // https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_modal_img
       var modal = document.getElementById('myModal');

      // Get the image and insert it inside the modal - use its "alt" text as a caption
      var img = document.getElementById(`${i}`);
      var modalImg = document.getElementById(`img01`);
      var captionText = document.getElementById('caption');
      img.onclick = function(){
          modal.style.display = "block";
          modalImg.src = x.image_url;
          captionText.innerHTML = x.description;
      }

      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      // When the user clicks on <span> (x), close the modal
      span.onclick = function() { 
          modal.style.display = "none";
      };
     
    });});}

    // since this is jquery, we will poll to "live" update website -- honestly pointless except for testing
    setInterval(function(){ update(); }, 3000);

    update();
  </script>
</html>
